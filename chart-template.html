<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bubble Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="chart-data.js"></script>
</head>
<body>
    <canvas id="bubbleChart" width="100%" height="50%"></canvas>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const category = urlParams.get('category');
        const marketData = chartData[category];

        if (!marketData) {
            alert('Invalid category!');
            throw new Error('Invalid category!');
        }

        const ctx = document.getElementById('bubbleChart').getContext('2d');

        // Determine min and max sizes to normalize the radii
        const minSize2023 = Math.min(...marketData.map(d => d.size2023));
        const maxSize2023 = Math.max(...marketData.map(d => d.size2023));

        const data = {
            datasets: marketData.map((d, i) => ({
                label: d.label,
                data: [{
                    x: d.size2023,
                    y: d.CAGR,
                    r: ((d.size2023 - minSize2023) / (maxSize2023 - minSize2023)) * 40 + 20, // scale radii
                    url: d.url,
                    size2030: d.size2030
                }],
                backgroundColor: `hsl(${i * 40}, 70%, 50%)`
            }))
        };

        const config = {
            type: 'bubble',
            data: data,
            options: {
                responsive: true,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const data = context.raw;
                                return `${context.dataset.label}: Market Size 2023: ${data.x} Bn, CAGR: ${data.y}%, Market Size 2030: ${data.size2030}`;
                            }
                        }
                    }
                },
                onClick: (event, elements) => {
                    if (elements.length > 0) {
                        const element = elements[0];
                        const dataset = data.datasets[element.datasetIndex];
                        const bubble = dataset.data[element.index];
                        window.open(bubble.url, '_blank'); 
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Market Size 2023 in USD Bn'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'CAGR (in %)'
                        }
                    }
                }
            }
        };

        new Chart(ctx, config);
    </script>
</body>
</html>
